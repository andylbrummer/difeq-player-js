!function(){angular.module("cmDemo",[]).directive("cmDemo",function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;return{scope:{running:"=",cmDemo:"&"},restrict:"E",requires:["draw"],transclude:!1,replace:!0,template:'<div class="demo-controls">\r\n                            <button class="btn" ng-click="running = true" ng-show="!running"><span class="glyphicon glyphicon-play"></span></button>\r\n                            <button class="btn" ng-click="running = false" ng-show="running"><span class="glyphicon glyphicon-pause"></button>\r\n                            <div class="btn-group">\r\n                                <button class="btn" ng-click="download()" class="extra"><span class="glyphicon glyphicon-picture"></button>\r\n                                <button class="btn" ng-click="fullScreen()" class="extra"><span class="glyphicon glyphicon-fullscreen"></button>\r\n                            </div>\r\n                    </div>',link:function(n,t,c){n.current=null;var r=function(t){n.startTime=n.startTime||t,n.cmDemo({t:t-n.startTimet}),n.running&&e(r)};n.$watch("running",function(n){n&&e(r)}),n.download=function(){var e=t.siblings("canvas")[0];e.toBlob(function(e){saveAs(e,c.filename||"pretty image.png")})},n.fullScreen=function(){var e=t.siblings("canvas")[0];n.startSize={width:e.width,height:e.height},e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen();var c=["webkitfullscreenchange","msfullscreenchange","mozfullscreenchange","fullscreenchange"],r=function(){document.mozFullScreenElement||document.webkitFullScreenElement||document.msFullScreenElement||document.fullScreenElement||(console.log("unsize"),e.width=n.startSize.width,e.height=n.startSize.height),jQuery.each(c,function(e,n){document.removeEventListener(n,r)})};jQuery.each(c,function(e,n){document.addEventListener(n,r)}),e.width=window.screen.width,e.height=window.screen.height}}}}).directive("drawTrace",function(){return{scope:{drawTrace:"="},controller:["$scope","$element",function(e,n){e.$watch("drawTrace.t",function(){e.draw&&e.drawTrace&&e.draw(e.drawTrace.trace,n[0].getContext("2d"))}),e.draw=function(e,n){n.canvas.height,n.canvas.width;n.clearRect(0,0,n.canvas.width,n.canvas.height),n.strokeStyle="hsla(0, 50%, 50%, 0.05)",n.beginPath(),n.moveTo(5*(e[e.length-1][0]+60),5*(e[e.length-1][1]+60));for(var t=e.length;t--;){var c=e[t];6e4==t&&(n.stroke(),n.beginPath(),n.strokeStyle="hsla(240, 80%, 50%, 0.05)"),n.lineTo(5*(c[0]+60),5*(c[1]+60))}n.stroke()}}]}}).controller("windCtrl",["$scope",function(e){e.advance=function(n){e.$apply(function(){e.state.t+=.01})}}])}();
var functionPathBuilder=function(e,t){var n=angular.extend({f:"=",t:"=",values:"=",paths:"=",model:"="},t);return{restrict:"A",scope:n,controller:["$scope","$attrs",function(t,n){t.$watch("t",function(){e(t,n)}),t.$watch("f",function(){e(t,n)}),t.$watch("values",function(){e(t,n)},!0)}]}};angular.module("paramApp",["ui.bootstrap-slider"]).directive("parameters",function(){return{restrict:"A",scope:{parameters:"=",values:"="},template:'<ul class="ctrl-parameters"><li ng-repeat="p in values"><span ng-bind="p.name"></span><div slider max="p.max" min="p.min" step="p.step" precision="p.precision" ng-model="p.value"></div></li></ul>',controller:["$scope",function(e){e.setValues=function(){var t=[];return jQuery.each(e.parameters,function(e,n){t.push({name:e,value:n[0]||0,min:n[1]||-1,max:n[2]||1,step:n[3]||.05,precision:2})}),e.values=t},e.setValues()}]}}).directive("pathRender",function(){return{restrict:"A",scope:{pathRender:"=",lineStyle:"=",lineWidth:"=",backgroundStyle:"=",range:"="},controller:["$scope","$element",function(e,t){var n=t[0],r=n.getContext("2d"),a=e.range||[-1,1,-1,1],i=r.backingStorePixelRatio||r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1,u=(window.devicePixelRatio||1)/i,o=n.width/(a[1]-a[0])/u,l=a[0],c=n.height/(a[3]-a[2])/u,v=a[2];r.lineWidth=e.lineWidth||2,r.fillStyle=e.backgroundStyle||"rgba(30, 30, 180, 0.025)";for(var f=20;f--;)r.fillRect(0,0,n.width,n.height);var s=function(t){r.lineWidth=.5,r.strokeStyle=e.lineStyle||"rgba(255,255,255,1.0)",r.fillStyle=e.backgroundStyle||"rgba(30, 30, 180, 0.025)",r.fillRect(0,0,n.width,n.height);for(var a=t.length;a--;){var i=t[a];r.beginPath();var u=i[i.length-1];r.moveTo((u[0]-l)*o,(u[1]-v)*c);for(var f=i.length;f--;){var s=i[f];r.lineTo((s[0]-l)*o,(s[1]-v)*c)}r.stroke()}};e.$watch("pathRender",function(e){e&&e.length&&e.length>0&&s(e)})}]}}).directive("densityRender",function(){return{restrict:"A",scope:{densityRender:"="},controller:["$scope","$element",function(e,t){var n=t[0],r=n.getContext("2d"),a=n.width/2,i=n.height/2,u={},o=Math.floor,l=function(e){r.fillStyle="rgba(0,0,0,1.0)",r.fillRect(0,0,n.width,n.height);for(var t=e.length;t--;)for(var l=e[t],c=n.width;c--;)for(var v=n.height;v--;){var f=o(100*l(c-a,v-i));r.fillStyle=0>f?u[f]||(u[f]="hsl(250,"+-f+"%,30%)"):u[f]||(u[f]="hsl(50,"+f+"%,30%)"),r.fillRect(c,v,1,1)}};e.$watch("densityRender",function(e){e&&e.length&&e.length>0&&l(e)})}]}}).directive("graph",function(){return functionPathBuilder(function(e,t){try{if(!e.f||!e.values)return;var n=jQuery.map(e.values,function(e){return parseFloat(e.value)}),r=jQuery.map(e.values,function(e){return e.name}),a=[],i=e.f;jQuery.isArray(i)||(i=[i]);for(var u=0;u<i.length;++u){for(var o=new Function(["t"].concat(r),"return "+i[u]+";"),l=[],c=[-1].concat(n),v={},f=-1;1.02>f;f+=.01)c[0]=f,l.push([f,o.apply(v,c)]);a.push(l)}e.paths=a}catch(s){}})}).directive("parametric",function(){return functionPathBuilder(function(e,t){try{if(!e.f||!e.values)return;var n=jQuery.map(e.values,function(e){return parseFloat(e.value)}),r=jQuery.map(e.values,function(e){return e.name}),a=[],i=e.f;jQuery.isArray(i)||(i=[i]);for(var u=0;u<i.length;++u){for(var o=new Function(["t"].concat(r),"return "+i[u]+";"),l=[],c=[0].concat(n),v={},f=-180;180>f;++f){c[0]=f/15;var s=o.apply(v,c);l.push([s[0],s[1]])}a.push(l)}e.paths=a}catch(h){}})}).directive("density",function(){return functionPathBuilder(function(e,t){try{if(!e.f||!e.values)return;var n=jQuery.map(e.values,function(e){return e.name+"="+e.value}),r=jQuery.map(e.values,function(e){return e.name}),a=[],i=e.f;jQuery.isArray(i)||(i=[i]);for(var u=0;u<i.length;++u){var o="var "+n+";return "+i[u]+";",l=new Function(["x","y"].concat(r),o);a.push(l)}e.paths=a}catch(c){}})}).directive("wind",function(){return functionPathBuilder(function(e,t){try{if(!e.f||!e.values)return;var n=e.model||{},r=(jQuery.map(e.values,function(e){return e.name}),e.range||[-1,1,-1,1]),a=r[1]-r[0],i=r[0],u=r[3]-r[2],o=r[2],l=e.f;jQuery.isArray(l)||(l=[l]);var c=[{name:"x",value:"v[0]"},{name:"y",value:"v[1]"},{name:"z",value:"v[2]"}].concat(e.values),v=jQuery.map(c,function(e){return e.name+"="+e.value}),f="var "+v+"; return ["+l[0]+"];";n.live_f=new Function(["v"],f);for(var s=e.model&&e.model.traces||[],h=e.t,m=e.count||3e3,d=m;d--;){var p=s[d];if(!p||Math.random()<.003){var v=[a*Math.random()+i,u*Math.random()+o,h],g=makeTrace(n,v,.01).move(2);s[d]=g}else p.move(1)}e.model=n,e.model.traces=s,e.paths=s.map(function(e){return e.trace})}catch(y){console.log(y)}},{range:"=",count:"="})}).directive("wind2",function(){return functionPathBuilder(function(e,t){if(e.f&&e.values){var n=e.model||{},r=(jQuery.map(e.values,function(e){return e.name}),e.range||[-1,1,-1,1]),a=r[1]-r[0],i=r[0],u=r[3]-r[2],o=r[2],l=e.f;jQuery.isArray(l)||(l=[l]);var c=[{name:"x",value:"v[0]"},{name:"y",value:"v[1]"},{name:"vx",value:"v[2]"},{name:"vy",value:"v[3]"},{name:"t",value:"v[4]"}].concat(e.values),v=jQuery.map(c,function(e){return e.name+"="+e.value}),f="var "+v+"; return ["+l[0]+"];";n.live_f=new Function(["v"],f);for(var s=e.model&&e.model.traces||[],h=e.t,m=e.count||1e3,d=m;d--;){var p=s[d];if(!p||Math.random()<.01){var v=[a*Math.random()+i,u*Math.random()+o,1,0,h],g=makeTrace(n,v,.01).move(2);s[d]=g}else p.move(1)}e.model=n,e.model.traces=s,e.paths=s.map(function(e){return e.trace})}},{range:"=",count:"="})}).controller("null",function(){});
Array.prototype.scale=function(t){for(var r=this.length;r--;)this[r]=this[r]*t;return this},Array.prototype.add=function(t){for(var r=this.length;r--;)this[r]=this[r]+t[r];return this},Array.prototype.as=function(t,r){for(var s=this.length;s--;)this[s]=this[s]+r*t[s];return this},Array.prototype.step=function(t,r){return this.as(t(this),r)},Array.prototype.step2=function(t,r){var s=this.slice(0).step(t,r/2);return this.add(t(s).scale(r))},Array.prototype.rk4=function(t,r){var s=t(this),i=t(this.slice(0).as(s,r/2)),e=t(this.slice(0).as(i,r/2)),a=t(this.slice(0).as(e,r));return this.slice(0).add(s.as(i,2).as(e,2).add(a).scale(r/6))},Array.prototype.predCor=function(t,r,s){};
var makeTrace=function(t,r,i){return{trace:[],p:r,f:t,dt:i,t:0,move:function(r){var e=r<this.trace.length?this.trace.slice(r):[],n=this.p,h=this.f.live_f||this.f;t=h.bind(this),i=this.dt,this.t+=this.dt;for(var s=r;s--;)e.push(n),n=n.rk4(t,i),n=n.rk4(t,i),n=n.rk4(t,i);return this.p=n,this.trace=e,this}}},makeLorenz=function(t,r,i){return function(e){var n=e[0],h=e[1],s=e[2];return[t*(h-n),n*(r-s)-h,n*h-i*s]}};
//# sourceMappingURL=cotm-demo.min.js.map