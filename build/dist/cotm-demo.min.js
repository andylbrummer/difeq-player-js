var functionPathBuilder=function(a,b){var c=angular.extend({f:"=",t:"=",values:"=",paths:"=",model:"="},b);return{restrict:"A",scope:c,controller:["$scope","$attrs",function(b,c){b.$watch("t",function(){a(b,c)}),b.$watch("f",function(){a(b,c)}),b.$watch("values",function(){a(b,c)},!0)}]}};angular.module("paramApp",["ui.bootstrap-slider"]).directive("parameters",function(){return{restrict:"A",scope:{parameters:"=",values:"="},template:'<ul class="ctrl-parameters"><li ng-repeat="p in values"><input type="text" ng-model="p.name"><div style="display:inline-block;width:100px;" slider use-decimals max="{{p.max}}" min="{{p.min}}" step="{{p.step}}" ng-model="p.value"></div><input type="text" ng-model="p.value"></li></ul>',controller:["$scope",function(a){a.setValues=function(){var b=[];return jQuery.each(a.parameters,function(a,c){b.push({name:a,value:c[0]||0,min:c[1]||-1,max:c[2]||1,step:c[3]||.05})}),a.values=b},a.setValues()}]}}).directive("pathRender",function(){return{restrict:"A",scope:{pathRender:"=",lineStyle:"=",lineWidth:"=",backgroundStyle:"=",range:"="},controller:["$scope","$element",function(a,b){var c=b[0],d=c.getContext("2d"),e=a.range||[-1,1,-1,1],f=c.width/(e[1]-e[0]),g=e[0],h=c.height/(e[3]-e[2]),i=e[2];d.lineWidth=a.lineWidth||2;var j=function(b){d.lineWidth=.5,d.strokeStyle=a.lineStyle||"rgba(255,255,255,1.0)",d.fillStyle=a.backgroundStyle||"rgba(30, 30, 180, 0.025)",d.fillRect(0,0,c.width,c.height);for(var e=b.length;e--;){var j=b[e];d.beginPath();var k=j[j.length-1];d.moveTo((k[0]-g)*f,(k[1]-i)*h);for(var l=j.length;l--;){var m=j[l];d.lineTo((m[0]-g)*f,(m[1]-i)*h)}d.stroke()}};a.$watch("pathRender",function(a){a&&a.length&&a.length>0&&j(a)})}]}}).directive("densityRender",function(){return{restrict:"A",scope:{densityRender:"="},controller:["$scope","$element",function(a,b){var c=b[0],d=c.getContext("2d"),e=c.width/2,f=c.height/2,g={},h=Math.floor,i=function(a){d.fillStyle="rgba(0,0,0,1.0)",d.fillRect(0,0,c.width,c.height);for(var b=a.length;b--;)for(var i=a[b],j=c.width;j--;)for(var k=c.height;k--;){var l=h(100*i(j-e,k-f));d.fillStyle=0>l?g[l]||(g[l]="hsl(250,"+-l+"%,30%)"):g[l]||(g[l]="hsl(50,"+l+"%,30%)"),d.fillRect(j,k,1,1)}};a.$watch("densityRender",function(a){a&&a.length&&a.length>0&&i(a)})}]}}).directive("graph",function(){return functionPathBuilder(function(a){try{if(!a.f||!a.values)return;var b=jQuery.map(a.values,function(a){return parseFloat(a.value)}),c=jQuery.map(a.values,function(a){return a.name}),d=[],e=a.f;jQuery.isArray(e)||(e=[e]);for(var f=0;f<e.length;++f){for(var g=new Function(["t"].concat(c),"return "+e[f]+";"),h=[],i=[-1].concat(b),j={},k=-1;1.02>k;k+=.01)i[0]=k,h.push([k,g.apply(j,i)]);d.push(h)}a.paths=d}catch(l){}})}).directive("parametric",function(){return functionPathBuilder(function(a){try{if(!a.f||!a.values)return;var b=jQuery.map(a.values,function(a){return parseFloat(a.value)}),c=jQuery.map(a.values,function(a){return a.name}),d=[],e=a.f;jQuery.isArray(e)||(e=[e]);for(var f=0;f<e.length;++f){for(var g=new Function(["t"].concat(c),"return "+e[f]+";"),h=[],i=[0].concat(b),j={},k=-180;180>k;++k){i[0]=k/15;var l=g.apply(j,i);h.push([l[0],l[1]])}d.push(h)}a.paths=d}catch(m){}})}).directive("density",function(){return functionPathBuilder(function(a){try{if(!a.f||!a.values)return;var b=jQuery.map(a.values,function(a){return a.name+"="+a.value}),c=jQuery.map(a.values,function(a){return a.name}),d=[],e=a.f;jQuery.isArray(e)||(e=[e]);for(var f=0;f<e.length;++f){var g="var "+b+";return "+e[f]+";",h=new Function(["x","y"].concat(c),g);d.push(h)}a.paths=d}catch(i){}})}).directive("wind",function(){return functionPathBuilder(function(a){try{if(!a.f||!a.values)return;var b=a.model||{},c=jQuery.map(a.values,function(a){return a.name+"="+a.value}),d=(jQuery.map(a.values,function(a){return a.name}),a.range||[-1,1,-1,1]),e=d[1]-d[0],f=d[0],g=d[3]-d[2],h=d[2],i=a.f;jQuery.isArray(i)||(i=[i]);var j="var x = v[0], y = v[1], t = v[2], "+c+"; return ["+i[0]+"];";b.live_f=new Function(["v"],j);for(var k=a.model&&a.model.traces||[],l=a.t,m=a.count||3e3,n=m;n--;){var o=k[n];if(!o||Math.random()<.003){var c=[e*Math.random()+f,g*Math.random()+h,l],p=makeTrace(b,c,.01).move(2);k[n]=p}else o.move(1)}a.model=b,a.model.traces=k,a.paths=k.map(function(a){return a.trace})}catch(q){console.log(q)}},{range:"=",count:"="})}).directive("wind2",function(){return functionPathBuilder(function(a){try{if(!a.f||!a.values)return;var b=a.model||{},c=jQuery.map(a.values,function(a){return a.name+"="+a.value}),d=(jQuery.map(a.values,function(a){return a.name}),a.range||[-1,1,-1,1]),e=d[1]-d[0],f=d[0],g=d[3]-d[2],h=d[2],i=a.f;jQuery.isArray(i)||(i=[i]);var j="var x = v[0], y = v[1], vx = v[2], vy = v[3], t = v[4], "+c+"; return ["+i[0]+"];";b.live_f=new Function(["v"],j);for(var k=a.model&&a.model.traces||[],l=a.t,m=a.count||1e3,n=m;n--;){var o=k[n];if(!o||Math.random()<.01){var c=[e*Math.random()+f,g*Math.random()+h,1,0,l],p=makeTrace(b,c,.01).move(2);k[n]=p}else o.move(1)}a.model=b,a.model.traces=k,a.paths=k.map(function(a){return a.trace})}catch(q){console.log(q)}},{range:"=",count:"="})}).controller("null",function(){}),angular.module("cmDemo",[]).directive("cmDemo",function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;return{scope:{running:"=",cmDemo:"&"},restrict:"E",requires:["draw"],transclude:!1,replace:!0,template:'<div class="btn-group">                            <button class="btn" ng-click="running = true" class="glyphicon glyphicon-play-circle"><span class="glyphicon glyphicon-play"></span></button>                            <button class="btn" ng-click="running = false"><span class="glyphicon glyphicon-stop"></button>                            <button class="btn" ng-click="download()"><span class="glyphicon glyphicon-picture"></button>                            <button class="btn" ng-click="fullScreen()"><span class="glyphicon glyphicon-fullscreen"></button>                    </div>',link:function(b,c,d){b.current=null;var e=function(c){b.startTime=b.startTime||c,b.cmDemo({t:c-b.startTimet}),b.running&&a(e)};b.$watch("running",function(b){b&&a(e)}),b.download=function(){var a=c.siblings("canvas")[0];a.toBlob(function(a){saveAs(a,d.filename||"pretty image.png")})},b.fullScreen=function(){var a=c.siblings("canvas")[0];b.startSize={width:a.width,height:a.height},a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen();var d=["webkitfullscreenchange","msfullscreenchange","mozfullscreenchange","fullscreenchange"],e=function(){document.mozFullScreenElement||document.webkitFullScreenElement||document.msFullScreenElement||document.fullScreenElement||(console.log("unsize"),a.width=b.startSize.width,a.height=b.startSize.height),jQuery.each(d,function(a,b){document.removeEventListener(b,e)})};jQuery.each(d,function(a,b){document.addEventListener(b,e)}),a.width=window.screen.width,a.height=window.screen.height}}}}).directive("drawTrace",function(){return{scope:{drawTrace:"="},controller:["$scope","$element",function(a,b){a.$watch("drawTrace.t",function(){a.draw&&a.drawTrace&&a.draw(a.drawTrace.trace,b[0].getContext("2d"))}),a.draw=function(a,b){b.canvas.height,b.canvas.width;b.clearRect(0,0,b.canvas.width,b.canvas.height),b.strokeStyle="hsla(0, 50%, 50%, 0.05)",b.beginPath(),b.moveTo(5*(a[a.length-1][0]+60),5*(a[a.length-1][1]+60));for(var c=a.length;c--;){var d=a[c];6e4==c&&(b.stroke(),b.beginPath(),b.strokeStyle="hsla(240, 80%, 50%, 0.05)"),b.lineTo(5*(d[0]+60),5*(d[1]+60))}b.stroke()}}]}}).controller("windCtrl",["$scope",function(a){a.advance=function(){a.$apply(function(){a.state.t+=.01})}}]),Array.prototype.scale=function(a){for(var b=this.length;b--;)this[b]=this[b]*a;return this},Array.prototype.add=function(a){for(var b=this.length;b--;)this[b]=this[b]+a[b];return this},Array.prototype.as=function(a,b){for(var c=this.length;c--;)this[c]=this[c]+b*a[c];return this},Array.prototype.step=function(a,b){return this.as(a(this),b)},Array.prototype.step2=function(a,b){var c=this.slice(0).step(a,b/2);return this.add(a(c).scale(b))},Array.prototype.rk4=function(a,b){var c=a(this),d=a(this.slice(0).as(c,b/2)),e=a(this.slice(0).as(d,b/2)),f=a(this.slice(0).as(e,b));return this.slice(0).add(c.as(d,2).as(e,2).add(f).scale(b/6))},Array.prototype.predCor=function(){};var makeTrace=function(a,b,c){return{trace:[],p:b,f:a,dt:c,t:0,move:function(b){var d=b<this.trace.length?this.trace.slice(b):[],e=this.p,f=this.f.live_f||this.f;a=f.bind(this),c=this.dt,this.t+=this.dt;for(var g=b;g--;)d.push(e),e=e.rk4(a,c),e=e.rk4(a,c),e=e.rk4(a,c);return this.p=e,this.trace=d,this}}},makeLorenz=function(a,b,c){return function(d){var e=d[0],f=d[1],g=d[2];return[a*(f-e),e*(b-g)-f,e*f-c*g]}};